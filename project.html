<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project ‚Äî Rodrigo Giliberti</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÆ</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0a0b;--bg2:#111114;--surface:#18181d;
  --border:#2a2a32;--accent:#e8ff47;--accent2:#ff6b35;
  --text:#e8e8e0;--muted:#6b6b78;--white:#f5f5f0;
  --danger:#ff4455;--success:#44ff88;
  --tr:.22s cubic-bezier(.4,0,.2,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;font-weight:300;overflow-x:hidden}
a{text-decoration:none;color:inherit}
img{max-width:100%;display:block}
button{cursor:pointer;border:none;background:none;font-family:inherit}

/* ‚îÄ‚îÄ TOP NAV ‚îÄ‚îÄ */
.topnav{position:fixed;top:0;left:0;right:0;z-index:200;display:flex;justify-content:space-between;align-items:center;padding:24px 48px;transition:padding var(--tr),background var(--tr),border-color var(--tr);border-bottom:1px solid transparent}
.topnav.scrolled{padding:14px 48px;background:rgba(10,10,11,.96);backdrop-filter:blur(12px);border-bottom-color:var(--border)}
.nav-logo{font-family:'Space Mono',monospace;font-size:11px;letter-spacing:.2em;color:var(--accent);text-transform:uppercase}
.nav-back{font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);display:flex;align-items:center;gap:8px;transition:color var(--tr)}
.nav-back:hover{color:var(--white)}
.nav-back svg{width:14px;height:14px}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.project-hero{min-height:62vh;display:flex;flex-direction:column;justify-content:flex-end;padding:120px 64px 56px;position:relative;overflow:hidden;border-bottom:1px solid var(--border)}
.hero-bg{position:absolute;inset:0;background:var(--surface)}
.hero-img{position:absolute;inset:0;object-fit:cover;width:100%;height:100%;filter:brightness(.28) saturate(.5)}
.hero-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(232,255,71,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(232,255,71,.03) 1px,transparent 1px);background-size:60px 60px}
.hero-ov{position:absolute;inset:0;background:linear-gradient(to top,rgba(10,10,11,.96) 0%,rgba(10,10,11,.35) 60%,transparent 100%)}
.hero-content{position:relative;z-index:2;max-width:920px}
.breadcrumb{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.25em;text-transform:uppercase;color:var(--muted);margin-bottom:20px;display:flex;align-items:center;gap:10px}
.breadcrumb span{color:var(--accent)}

/* Hero tag strip ‚Äî clickable, scroll to section */
.hero-tags{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap}
.htag{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);border:1px solid var(--border);padding:5px 12px;transition:all var(--tr);cursor:default}
.htag.linked{cursor:pointer}
.htag.linked:hover{border-color:var(--accent);color:var(--accent);background:rgba(232,255,71,.06)}
.htag.type-tag{border-color:rgba(232,255,71,.35);color:var(--accent);background:rgba(232,255,71,.05)}

/* LDD / Doc buttons in hero */
.hero-doc-btns{display:flex;gap:10px;margin-bottom:24px;flex-wrap:wrap}
.doc-btn{display:inline-flex;align-items:center;gap:8px;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.15em;text-transform:uppercase;padding:9px 18px;border:1px solid var(--border);color:var(--muted);transition:all var(--tr);cursor:pointer}
.doc-btn:hover{border-color:var(--accent);color:var(--accent)}
.doc-btn.active{border-color:var(--accent);color:var(--accent);background:rgba(232,255,71,.07)}
.doc-btn svg{width:12px;height:12px;flex-shrink:0}

.hero-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(60px,9vw,118px);line-height:.91;color:var(--white);letter-spacing:.01em;margin-bottom:24px}
.hero-meta{display:flex;gap:40px;flex-wrap:wrap}
.meta-item{display:flex;flex-direction:column;gap:4px}
.meta-label{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:.25em;text-transform:uppercase;color:var(--muted)}
.meta-value{font-family:'Space Mono',monospace;font-size:12px;color:var(--white)}
/* Hero image upload btn */
.hero-upload-btn{display:none;position:absolute;bottom:20px;right:20px;z-index:10;background:var(--accent);color:#0a0a0b;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.15em;text-transform:uppercase;font-weight:700;padding:9px 16px;align-items:center;gap:7px;cursor:pointer}
.hero-upload-btn svg{width:12px;height:12px}
.hero-upload-btn input{position:absolute;inset:0;opacity:0;cursor:pointer;z-index:2}
body.edit-active .hero-upload-btn{display:flex}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.project-layout{display:grid;grid-template-columns:236px 1fr;min-height:80vh}
.sidebar{border-right:1px solid var(--border);position:sticky;top:57px;height:calc(100vh - 57px);overflow-y:auto;padding:36px 0;background:var(--bg2)}
.snav{list-style:none;display:flex;flex-direction:column}
.snav-item a{display:flex;align-items:center;gap:10px;padding:11px 22px;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.13em;text-transform:uppercase;color:var(--muted);transition:color var(--tr),background var(--tr);border-left:2px solid transparent}
.snav-item a:hover{color:var(--white);background:rgba(255,255,255,.03)}
.snav-item a.active{color:var(--accent);border-left-color:var(--accent);background:rgba(232,255,71,.04)}
.snav-num{opacity:.35;font-size:8px}
.sdivider{height:1px;background:var(--border);margin:14px 22px}
.sproj-wrap{padding:14px 22px 0}
.sproj-label{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);margin-bottom:10px}
.sproj-link{display:flex;align-items:center;gap:7px;padding:7px 0;font-family:'Space Mono',monospace;font-size:9px;color:var(--muted);transition:color var(--tr);border-bottom:1px solid var(--border)}
.sproj-link:last-child{border-bottom:none}
.sproj-link:hover,.sproj-link.cur{color:var(--accent)}
.sproj-dot{width:5px;height:5px;border-radius:50%;background:var(--border);flex-shrink:0}
.sproj-link.cur .sproj-dot{background:var(--accent)}

.main-content{padding:60px}

/* ‚îÄ‚îÄ SECTIONS ‚Äî drag & drop ‚îÄ‚îÄ */
.cs-section{margin-bottom:72px;scroll-margin-top:80px;position:relative;transition:opacity .2s,transform .2s}
.cs-section.dragging-section{opacity:.35}
.cs-section.drag-over-section{border-top:2px solid var(--accent)}

/* Drag handle on section ‚Äî edit mode only */
.section-drag-handle{display:none;position:absolute;left:-28px;top:4px;width:22px;height:32px;flex-direction:column;justify-content:center;align-items:center;gap:3px;cursor:grab;opacity:.3;transition:opacity var(--tr)}
.section-drag-handle:hover{opacity:1}
.section-drag-handle span{display:block;width:12px;height:2px;background:var(--accent);border-radius:1px}
body.edit-active .section-drag-handle{display:flex}
body.edit-active .main-content{padding-left:88px}

.cs-label{font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.3em;color:var(--accent);text-transform:uppercase;margin-bottom:28px;display:flex;align-items:center;gap:14px}
.cs-label::after{content:'';flex:1;height:1px;background:var(--border)}
.cs-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(38px,5vw,62px);line-height:.94;color:var(--white);margin-bottom:22px}
.cs-body{font-size:15px;line-height:1.82;color:var(--muted);max-width:720px}
.cs-body strong{color:var(--text);font-weight:500}
.cs-body p+p{margin-top:14px}

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
.cs-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:2px;margin:36px 0}
.cs-stat{background:var(--surface);border:1px solid var(--border);padding:26px 22px}
.cs-stat-n{font-family:'Bebas Neue',sans-serif;font-size:46px;color:var(--accent);line-height:1;margin-bottom:4px}
.cs-stat-l{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.14em;text-transform:uppercase;color:var(--muted)}

/* ‚îÄ‚îÄ TWO COLS ‚îÄ‚îÄ */
.cs-2col{display:grid;grid-template-columns:1fr 1fr;gap:2px;margin:28px 0}
.cs-col{background:var(--surface);border:1px solid var(--border);padding:30px}
.cs-col-label{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--accent);margin-bottom:10px}
.cs-col-title{font-family:'Bebas Neue',sans-serif;font-size:23px;color:var(--white);margin-bottom:10px}
.cs-col p{font-size:13px;line-height:1.78;color:var(--muted)}

/* ‚îÄ‚îÄ LDD INLINE PANEL ‚îÄ‚îÄ */
.ldd-panel{display:none;margin-top:32px;border:1px solid rgba(232,255,71,.2);background:rgba(232,255,71,.02);overflow:hidden}
.ldd-panel.open{display:block}
.ldd-panel-header{display:flex;align-items:center;justify-content:space-between;padding:20px 28px;border-bottom:1px solid rgba(232,255,71,.15);background:rgba(232,255,71,.04)}
.ldd-panel-title{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--accent);letter-spacing:.03em}
.ldd-panel-close{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);border:1px solid var(--border);padding:6px 14px;cursor:pointer;transition:all var(--tr)}
.ldd-panel-close:hover{color:var(--white);border-color:var(--white)}
.ldd-panel-body{padding:28px}
.ldd-section{margin-bottom:32px}
.ldd-section-title{font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.2em;text-transform:uppercase;color:var(--accent);margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--border)}
.ldd-text{font-size:14px;line-height:1.8;color:var(--muted)}
.ldd-text strong{color:var(--text);font-weight:500}
.ldd-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px}
.ldd-item{background:var(--surface);border:1px solid var(--border);padding:16px 20px}
.ldd-item-label{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:.18em;text-transform:uppercase;color:var(--muted);margin-bottom:6px}
.ldd-item-val{font-size:13px;color:var(--white);font-weight:400}

/* ‚îÄ‚îÄ TAGS ‚îÄ‚îÄ */
.cs-tags-wrap{margin:24px 0;display:flex;flex-direction:column;gap:10px}
.cs-tags-row{display:flex;gap:7px;flex-wrap:wrap;align-items:center}
.cs-tag{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);border:1px solid var(--border);padding:5px 11px;transition:all var(--tr);cursor:pointer;position:relative;user-select:none}
.cs-tag:hover,.cs-tag.on{border-color:var(--accent);color:var(--accent);background:rgba(232,255,71,.06)}
.cs-tag .tdel{display:none;position:absolute;top:-7px;right:-7px;width:15px;height:15px;background:var(--danger);color:#fff;font-size:9px;align-items:center;justify-content:center;border-radius:50%;z-index:2;line-height:1}
body.edit-active .cs-tag .tdel{display:flex}
.cs-add-tag{display:none;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;color:rgba(232,255,71,.45);border:1px dashed rgba(232,255,71,.22);padding:5px 13px;cursor:pointer;transition:all var(--tr);align-items:center;gap:5px}
.cs-add-tag svg{width:10px;height:10px}
.cs-add-tag:hover{color:var(--accent);border-color:var(--accent)}
body.edit-active .cs-add-tag{display:inline-flex}

/* ‚îÄ‚îÄ GALLERY ‚îÄ‚îÄ */
.cs-gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:2px;margin:28px 0}
.gslot{aspect-ratio:16/9;position:relative;overflow:hidden;background:var(--surface);border:1px solid var(--border)}
.gslot.filled{cursor:zoom-in}
.gslot.filled img{width:100%;height:100%;object-fit:cover;filter:brightness(.78) saturate(.65);transition:filter .28s,transform .28s;display:block}
.gslot.filled:hover img{filter:brightness(1) saturate(.9);transform:scale(1.04)}
.gslot.filled:hover .gexpand{opacity:1}
.gexpand{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .22s;background:rgba(10,10,11,.28);pointer-events:none}
.gexpand svg{color:var(--accent);width:28px;height:28px}
.gdel{display:none;position:absolute;top:7px;right:7px;z-index:10;background:var(--danger);color:#fff;width:24px;height:24px;align-items:center;justify-content:center;font-size:14px;cursor:pointer;border-radius:2px;border:none}
body.edit-active .gslot.filled .gdel{display:flex}
.gslot.empty{display:none}
body.edit-active .gslot.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:7px;border:1px dashed rgba(232,255,71,.18);cursor:pointer;transition:border-color var(--tr),background var(--tr)}
body.edit-active .gslot.empty:hover{border-color:var(--accent);background:rgba(232,255,71,.03)}
.gempty-icon{color:var(--border);transition:color var(--tr)}
body.edit-active .gslot.empty:hover .gempty-icon{color:rgba(232,255,71,.4)}
.gempty-label{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);opacity:0;transition:opacity var(--tr)}
body.edit-active .gslot.empty:hover .gempty-label{opacity:1}
.gslot input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer;z-index:5}

/* ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ */
.lb{position:fixed;inset:0;z-index:9500;background:rgba(0,0,0,.96);display:none;align-items:center;justify-content:center}
.lb.open{display:flex}
.lb-img{max-width:90vw;max-height:88vh;object-fit:contain;border:1px solid var(--border);display:block}
.lb-close{position:fixed;top:18px;right:22px;background:none;border:1px solid var(--border);color:var(--muted);width:36px;height:36px;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all var(--tr)}
.lb-close:hover{color:var(--white);border-color:var(--white)}
.lb-nav{position:fixed;top:50%;transform:translateY(-50%);background:rgba(10,10,11,.7);border:1px solid var(--border);color:var(--muted);width:46px;height:46px;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all var(--tr)}
.lb-nav:hover{color:var(--accent);border-color:var(--accent)}
.lb-prev{left:10px}.lb-next{right:10px}
.lb-count{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.14em;color:var(--muted)}

/* ‚îÄ‚îÄ NEXT/PREV ‚îÄ‚îÄ */
.proj-nav{display:grid;grid-template-columns:1fr 1fr;border-top:1px solid var(--border)}
.pn-item{padding:38px 46px;display:flex;flex-direction:column;gap:7px;transition:background var(--tr)}
.pn-item:hover{background:var(--surface)}
.pn-item:first-child{border-right:1px solid var(--border)}
.pn-dir{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--muted)}
.pn-title{font-family:'Bebas Neue',sans-serif;font-size:30px;color:var(--white);transition:color var(--tr)}
.pn-item:hover .pn-title{color:var(--accent)}

/* ‚îÄ‚îÄ ADMIN BAR ‚îÄ‚îÄ */
.admin-bar{position:fixed;top:0;left:0;right:0;z-index:9100;height:52px;background:rgba(10,10,11,.97);border-bottom:2px solid var(--accent);display:none;align-items:center;padding:0 10px;gap:0;overflow-x:auto;box-shadow:0 4px 24px rgba(232,255,71,.08)}
.admin-bar.visible{display:flex}
.ab-logo{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.18em;text-transform:uppercase;color:var(--accent);padding-right:14px;border-right:1px solid var(--border);margin-right:4px;white-space:nowrap;flex-shrink:0}
.ab-btn{display:inline-flex;align-items:center;gap:5px;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.09em;text-transform:uppercase;color:var(--muted);padding:8px 10px;border:none;background:none;cursor:pointer;transition:color var(--tr),background var(--tr);white-space:nowrap;height:52px;flex-shrink:0;position:relative}
.ab-btn svg{width:11px;height:11px;flex-shrink:0}
.ab-btn:hover{color:var(--white);background:rgba(255,255,255,.04)}
.ab-btn.on{color:var(--accent);background:rgba(232,255,71,.06)}
.ab-btn.on::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--accent)}
.ab-sep{width:1px;height:26px;background:var(--border);margin:0 3px;flex-shrink:0}
.ab-spacer{flex:1;min-width:4px}
.ab-save{display:inline-flex;align-items:center;gap:5px;background:var(--accent);color:#0a0a0b;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;font-weight:700;padding:8px 16px;cursor:pointer;border:none;transition:background var(--tr);white-space:nowrap;height:36px;margin-right:6px;flex-shrink:0}
.ab-save:hover{background:#fff}
.ab-save svg{width:11px;height:11px}
.ab-logout{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.09em;text-transform:uppercase;color:var(--muted);padding:7px 9px;border:1px solid var(--border);cursor:pointer;background:none;transition:all var(--tr);flex-shrink:0}
.ab-logout:hover{color:var(--danger);border-color:var(--danger)}
body.edit-active{padding-top:52px}
body.edit-active .topnav{top:52px}
body.edit-active .sidebar{top:109px;height:calc(100vh - 109px)}

/* ‚îÄ‚îÄ EDITABLE ‚îÄ‚îÄ */
[data-editable]{transition:outline var(--tr)}
body.edit-active [data-editable]:hover{outline:2px dashed rgba(232,255,71,.3);outline-offset:2px;cursor:text}
body.edit-active [data-editable][contenteditable="true"]:focus{outline:2px solid var(--accent);outline-offset:2px;background:rgba(232,255,71,.02)}

/* ‚îÄ‚îÄ TAG MODAL ‚îÄ‚îÄ */
.tag-modal{position:fixed;inset:0;z-index:9800;background:rgba(0,0,0,.82);display:none;align-items:center;justify-content:center}
.tag-modal.open{display:flex}
.tag-modal-box{background:var(--bg2);border:1px solid var(--border);padding:30px;width:100%;max-width:400px}
.tag-modal-title{font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.2em;text-transform:uppercase;color:var(--accent);margin-bottom:14px}
.tag-modal-input{width:100%;background:var(--bg);border:1px solid var(--border);color:var(--white);font-family:'Space Mono',monospace;font-size:13px;padding:11px 13px;outline:none;transition:border-color var(--tr);margin-bottom:7px}
.tag-modal-input:focus{border-color:var(--accent)}
.tag-modal-hint{font-family:'Space Mono',monospace;font-size:9px;color:var(--muted);margin-bottom:18px}
.tag-modal-btns{display:flex;gap:10px;justify-content:flex-end}
.tag-modal-add{background:var(--accent);color:#0a0a0b;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.14em;text-transform:uppercase;font-weight:700;padding:10px 20px;cursor:pointer;border:none;transition:background var(--tr)}
.tag-modal-add:hover{background:#fff}
.tag-modal-cancel{background:none;color:var(--muted);border:1px solid var(--border);font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.14em;text-transform:uppercase;padding:10px 13px;cursor:pointer;transition:all var(--tr)}
.tag-modal-cancel:hover{color:var(--white);border-color:var(--muted)}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%) translateY(14px);z-index:9999;background:var(--surface);border:1px solid var(--border);font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.09em;padding:10px 20px;opacity:0;transition:all .22s;white-space:nowrap;pointer-events:none;max-width:90vw;overflow:hidden;text-overflow:ellipsis}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.success{border-color:rgba(68,255,136,.4);color:var(--success)}
.toast.error{border-color:rgba(255,68,85,.4);color:var(--danger)}

/* ‚îÄ‚îÄ REVEAL ‚îÄ‚îÄ */
.reveal{opacity:0;transform:translateY(26px);transition:opacity .62s ease,transform .62s ease}
.reveal.visible{opacity:1;transform:translateY(0)}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:1100px){.project-layout{grid-template-columns:1fr}.sidebar{display:none}.main-content{padding:40px 24px}body.edit-active .main-content{padding-left:24px}}
@media(max-width:900px){.topnav{padding:16px 24px}.project-hero{padding:100px 24px 44px}.cs-stats{grid-template-columns:1fr 1fr}.cs-2col{grid-template-columns:1fr}.cs-gallery{grid-template-columns:1fr 1fr}.proj-nav{grid-template-columns:1fr}.pn-item:first-child{border-right:none;border-bottom:1px solid var(--border)}.ldd-grid{grid-template-columns:1fr}}
@media(max-width:600px){.cs-gallery{grid-template-columns:1fr}.cs-stats{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>

<!-- ‚ïê‚ïê ADMIN BAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="admin-bar" id="adminBar">
  <span class="ab-logo">‚¨° Edit</span>

  <button class="ab-btn" id="btn-text" onclick="toggleMode('text')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
    All Texts
  </button>
  <button class="ab-btn" id="btn-images" onclick="toggleMode('images')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
    Images
  </button>
  <button class="ab-btn" id="btn-tags" onclick="toggleMode('tags')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
    Tags
  </button>
  <button class="ab-btn" id="btn-drag" onclick="toggleMode('drag')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/></svg>
    Reorder
  </button>
  <div class="ab-sep"></div>
  <button class="ab-btn" onclick="addGallerySlot()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
    + Img Slot
  </button>

  <div class="ab-spacer"></div>
  <button class="ab-save" onclick="saveAll()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
    Save & Download
  </button>
  <button class="ab-logout" onclick="logout()">Logout</button>
</div>

<!-- ‚ïê‚ïê TOP NAV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<nav class="topnav" id="topnav">
  <a href="index.html" class="nav-logo">Rodrigo Giliberti</a>
  <a href="index.html#projects" class="nav-back">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
    All Projects
  </a>
</nav>

<!-- ‚ïê‚ïê HERO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="project-hero" id="projectHero">
  <div class="hero-bg"></div>
  <img class="hero-img" id="heroImg" src="" alt="" style="display:none">
  <div class="hero-grid"></div>
  <div class="hero-ov"></div>
  <div class="hero-content">
    <div class="breadcrumb">Projects <span>‚Ä∫</span> <span id="breadcrumb-title">Loading...</span></div>

    <!-- Tags ‚Äî clickable, scroll to section -->
    <div class="hero-tags" id="heroTags"></div>

    <!-- Doc buttons: Blockout ‚Üí gallery section, LDD ‚Üí inline panel -->
    <div class="hero-doc-btns" id="heroDocBtns" style="display:none">
      <button class="doc-btn" id="btnBlockout" onclick="scrollToSection('gallery')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
        Blockout Process
      </button>
      <button class="doc-btn" id="btnLDD" onclick="toggleLDD()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        LDD Document
      </button>
    </div>

    <h1 class="hero-title" id="heroTitle" data-editable data-key="hero_title">Loading...</h1>
    <div class="hero-meta" id="heroMeta"></div>
  </div>
  <label class="hero-upload-btn">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
    Change Hero Image
    <input type="file" id="heroImgInput" accept="image/*">
  </label>
</div>

<!-- ‚ïê‚ïê LAYOUT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="project-layout">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <ul class="snav" id="sidebarNav"></ul>
    <div class="sdivider"></div>
    <div class="sproj-wrap">
      <p class="sproj-label">Other Projects</p>
      <div id="sprojLinks"></div>
    </div>
  </aside>

  <!-- MAIN ‚Äî sections rendered by JS so they can be reordered -->
  <main class="main-content" id="mainContent"></main>
</div>

<!-- FOOTER NAV -->
<div class="proj-nav" id="projNav"></div>

<!-- LIGHTBOX -->
<div class="lb" id="lb" onclick="lbClose()">
  <button class="lb-nav lb-prev" onclick="event.stopPropagation();lbStep(-1)">‚Äπ</button>
  <img class="lb-img" id="lbImg" src="" alt="" onclick="event.stopPropagation()">
  <button class="lb-nav lb-next" onclick="event.stopPropagation();lbStep(1)">‚Ä∫</button>
  <button class="lb-close" onclick="lbClose()">√ó</button>
  <div class="lb-count" id="lbCount"></div>
</div>

<!-- TAG MODAL -->
<div class="tag-modal" id="tagModal">
  <div class="tag-modal-box">
    <p class="tag-modal-title">Add Tag</p>
    <input class="tag-modal-input" id="tagInput" placeholder="e.g. Tension, Horror, Wonder..." autocomplete="off">
    <p class="tag-modal-hint">Separate with commas ¬∑ Press Enter to add</p>
    <div class="tag-modal-btns">
      <button class="tag-modal-cancel" onclick="closeTagModal()">Cancel</button>
      <button class="tag-modal-add" onclick="submitTags()">Add</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ADMIN_PASS = 'rg2025admin';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const isAdmin = sessionStorage.getItem('rg_admin') === '1';
let allProjects = [], project = null;
let projectId = parseInt(new URLSearchParams(location.search).get('id') || '0');
let csData = {};
let galleryImgs = [];
let lbIndex = 0;
let activeTagsId = null;
let textOn = false, dragOn = false;
let lddOpen = false;

// Section definitions ‚Äî order can be changed by user
const DEFAULT_SECTION_ORDER = ['overview','goals','experience','flow','encounters','systems','challenges','ldd','gallery'];

const SECTION_META = {
  overview:   { num:'01', label:'Overview',        sidebar:'Overview' },
  goals:      { num:'02', label:'Design Goals',    sidebar:'Goals' },
  experience: { num:'03', label:'Player Experience', sidebar:'Player Experience' },
  flow:       { num:'04', label:'Level Flow',      sidebar:'Level Flow' },
  encounters: { num:'05', label:'Encounters',      sidebar:'Encounters' },
  systems:    { num:'06', label:'Systems',         sidebar:'Systems' },
  challenges: { num:'07', label:'Challenges',      sidebar:'Challenges' },
  ldd:        { num:'08', label:'LDD Document',    sidebar:'LDD Doc' },
  gallery:    { num:'09', label:'Gallery',         sidebar:'Gallery' },
};

const DEFAULT_TAGS = ['Tension','Exploration','Wonder','Dread','Relief','Challenge','Discovery'];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', async () => {
  await loadProjects();
  loadSaved();
  buildHero();
  buildSections();
  buildSidebar();
  buildFooterNav();
  initNav();
  initReveal();
  initSidebarSpy();
  initFastScroll();
  if (isAdmin) {
    document.getElementById('adminBar').classList.add('visible');
    document.body.classList.add('edit-active');
    document.getElementById('heroDocBtns').style.display = 'flex';
  } else {
    // Show doc buttons to visitors too if project has data
    document.getElementById('heroDocBtns').style.display = 'flex';
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FAST SCROLL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initFastScroll() {
  document.addEventListener('click', e => {
    const link = e.target.closest('a[href^="#"]');
    if (!link) return;
    const id = link.getAttribute('href').slice(1);
    const el = document.getElementById(id);
    if (!el) return;
    e.preventDefault();
    scrollToEl(el);
  });
}
function scrollToEl(el) {
  const offset = isAdmin ? 72 : 20;
  const y = el.getBoundingClientRect().top + window.scrollY - offset;
  smoothTo(y, 380);
}
function scrollToSection(id) {
  const el = document.getElementById('section-' + id);
  if (el) scrollToEl(el);
}
function smoothTo(target, dur) {
  const start = window.scrollY, dist = target - start, t0 = performance.now();
  const step = now => {
    const t = Math.min((now-t0)/dur, 1);
    const e = t<.5 ? 2*t*t : -1+(4-2*t)*t;
    window.scrollTo(0, start + dist*e);
    if (t<1) requestAnimationFrame(step);
  };
  requestAnimationFrame(step);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadProjects() {
  const local = localStorage.getItem('rg_projects');
  if (local) { allProjects = JSON.parse(local); project = allProjects[projectId]; return; }
  try {
    const r = await fetch('projects.json');
    if (r.ok) { allProjects = await r.json(); localStorage.setItem('rg_projects', JSON.stringify(allProjects)); }
  } catch(e) {}
  project = allProjects[projectId] || null;
}

function loadSaved() {
  const s = localStorage.getItem(`rg_cs_${projectId}`);
  if (s) csData = JSON.parse(s);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HERO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildHero() {
  if (!project) { document.getElementById('heroTitle').textContent = 'Not Found'; return; }
  document.title = `${project.title} ‚Äî Rodrigo Giliberti`;
  document.getElementById('breadcrumb-title').textContent = project.title;

  // Hero title (editable)
  const titleEl = document.getElementById('heroTitle');
  titleEl.textContent = csData['hero_title'] || project.title;

  // Hero image
  const src = project._imageDataUrl || project.image;
  if (src) { const img=document.getElementById('heroImg'); img.src=src; img.style.display='block'; img.onerror=()=>img.style.display='none'; }

  // Hero tags ‚Äî each scrolls to matching section
  const tagSectionMap = {
    'blockout': 'gallery', 'ue5': 'systems', 'unity': 'systems',
    'ue4': 'systems', 'narrative': 'experience', 'systems': 'systems',
    'encounter': 'encounters', 'level design': 'flow', 'game design': 'goals',
  };
  const tagsEl = document.getElementById('heroTags');
  const type = project.type || 'Level Design';
  let html = `<span class="htag type-tag" onclick="scrollToSection('overview')">${type}</span>`;
  (project.tags||[]).forEach(t => {
    const key = t.toLowerCase();
    const target = tagSectionMap[key] || 'overview';
    html += `<span class="htag linked" onclick="scrollToSection('${target}')" title="‚Üí ${SECTION_META[target]?.sidebar||target}">${t}</span>`;
  });
  tagsEl.innerHTML = html;

  // Meta
  const eng = (project.tags||[]).find(t=>['UE5','Unity','UE4','Custom'].includes(t))||'‚Äî';
  document.getElementById('heroMeta').innerHTML = `
    <div class="meta-item"><span class="meta-label">Year</span><span class="meta-value" data-editable data-key="meta_year">${csData['meta_year']||project.year||'2024'}</span></div>
    <div class="meta-item"><span class="meta-label">Engine</span><span class="meta-value" data-editable data-key="meta_engine">${csData['meta_engine']||eng}</span></div>
    <div class="meta-item"><span class="meta-label">Role</span><span class="meta-value" data-editable data-key="meta_role">${csData['meta_role']||type}</span></div>
    <div class="meta-item"><span class="meta-label">Duration</span><span class="meta-value" data-editable data-key="meta_dur">${csData['meta_dur']||'‚Äî'}</span></div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BUILD ALL SECTIONS (JS-rendered so order is flexible)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildSections() {
  const order = csData['section_order'] ? JSON.parse(csData['section_order']) : DEFAULT_SECTION_ORDER;
  const container = document.getElementById('mainContent');
  container.innerHTML = '';
  order.forEach(id => {
    const el = buildSection(id);
    if (el) container.appendChild(el);
  });
  initReveal();
  if (dragOn) enableSectionDrag();
}

function buildSection(id) {
  const builders = { overview, goals, experience, flow, encounters, systems, challenges, ldd, gallery };
  return builders[id] ? builders[id]() : null;
}

function d(v,k,fallback='') {
  // get editable value with fallback
  return csData[k] !== undefined ? csData[k] : fallback;
}

// ‚îÄ‚îÄ section builders ‚îÄ‚îÄ
function overview() {
  return sec('overview', SECTION_META.overview, `
    <h2 class="cs-title" data-editable data-key="ov_title">${d('','ov_title','Project Overview')}</h2>
    <div class="cs-body" data-editable data-key="ov_body">${d('','ov_body','<p>Describe what this project is ‚Äî genre, engine, and the core design challenge you were solving.</p><p>What made it unique? What were the constraints? Who was the target audience?</p>')}</div>
    <div class="cs-stats">
      <div class="cs-stat reveal"><div class="cs-stat-n" data-editable data-key="s1n">${d('','s1n','UE5')}</div><div class="cs-stat-l" data-editable data-key="s1l">${d('','s1l','Engine')}</div></div>
      <div class="cs-stat reveal"><div class="cs-stat-n" data-editable data-key="s2n">${d('','s2n','Solo')}</div><div class="cs-stat-l" data-editable data-key="s2l">${d('','s2l','Team Size')}</div></div>
      <div class="cs-stat reveal"><div class="cs-stat-n" data-editable data-key="s3n">${d('','s3n','8wk')}</div><div class="cs-stat-l" data-editable data-key="s3l">${d('','s3l','Duration')}</div></div>
      <div class="cs-stat reveal"><div class="cs-stat-n" data-editable data-key="s4n">${d('','s4n', project?.year||'2024')}</div><div class="cs-stat-l" data-editable data-key="s4l">${d('','s4l','Year')}</div></div>
    </div>`);
}
function goals() {
  return sec('goals', SECTION_META.goals, `
    <h2 class="cs-title" data-editable data-key="go_title">${d('','go_title','Goals & Intentions')}</h2>
    <div class="cs-2col">
      <div class="cs-col reveal"><div class="cs-col-label">Design Goal</div><div class="cs-col-title" data-editable data-key="go1t">${d('','go1t','Primary Objective')}</div><p data-editable data-key="go1b">${d('','go1b','Describe your first design goal. What did you set out to achieve?')}</p></div>
      <div class="cs-col reveal"><div class="cs-col-label">Design Goal</div><div class="cs-col-title" data-editable data-key="go2t">${d('','go2t','Secondary Objective')}</div><p data-editable data-key="go2b">${d('','go2b','Describe your second goal. What skills were you demonstrating?')}</p></div>
    </div>
    <div class="cs-body" data-editable data-key="go_body" style="margin-top:28px">${d('','go_body','<p>Additional context: reference games, design philosophy, key decisions that guided this project.</p>')}</div>`);
}
function experience() {
  const tags = csData['exp_tags'] ? JSON.parse(csData['exp_tags']) : DEFAULT_TAGS;
  return sec('experience', SECTION_META.experience, `
    <h2 class="cs-title" data-editable data-key="ex_title">${d('','ex_title','What Should Players Feel?')}</h2>
    <div class="cs-body" data-editable data-key="ex_body">${d('','ex_body','<p>Describe the intended emotional journey. What should players feel at the start, middle, and end?</p><p>Tension, relief, wonder, dread ‚Äî what was the arc you designed toward?</p>')}</div>
    <div class="cs-tags-wrap">
      <div class="cs-tags-row" id="expTags">${renderTagsHTML('expTags', tags)}</div>
      <button class="cs-add-tag" onclick="openTagModal('expTags')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Add Tag</button>
    </div>`);
}
function flow() {
  return sec('flow', SECTION_META.flow, `
    <h2 class="cs-title" data-editable data-key="fl_title">${d('','fl_title','Level Flow & Layout')}</h2>
    <div class="cs-body" data-editable data-key="fl_body">${d('','fl_body','<p>Explain your level layout decisions. How does the player navigate? Linear, open, or branching?</p><p>Where are the choke points, breathing rooms, escalation beats?</p>')}</div>
    <div class="cs-2col" style="margin-top:28px">
      <div class="cs-col reveal"><div class="cs-col-label">Approach</div><div class="cs-col-title" data-editable data-key="fl1t">${d('','fl1t','Layout Structure')}</div><p data-editable data-key="fl1b">${d('','fl1b','Linear, hub-and-spoke, open world? How does the player move through the space?')}</p></div>
      <div class="cs-col reveal"><div class="cs-col-label">Technique</div><div class="cs-col-title" data-editable data-key="fl2t">${d('','fl2t','Navigation & Wayfinding')}</div><p data-editable data-key="fl2b">${d('','fl2b','How does the player know where to go? Lighting, color, landmarks, environmental cues?')}</p></div>
    </div>`);
}
function encounters() {
  return sec('encounters', SECTION_META.encounters, `
    <h2 class="cs-title" data-editable data-key="en_title">${d('','en_title','Encounter Design')}</h2>
    <div class="cs-body" data-editable data-key="en_body">${d('','en_body','<p>Walk through how you designed key encounters ‚Äî enemy placement, threat positioning, cover, pacing between fights.</p><p>What was the design intent behind your most interesting encounter?</p>')}</div>`);
}
function systems() {
  return sec('systems', SECTION_META.systems, `
    <h2 class="cs-title" data-editable data-key="sy_title">${d('','sy_title','Systems & Technical Work')}</h2>
    <div class="cs-body" data-editable data-key="sy_body">${d('','sy_body','<p>What technical work did you do? Blueprints, scripting, AI behavior, triggers, level streaming?</p><p>What was the most technically challenging part?</p>')}</div>
    <div class="cs-2col" style="margin-top:28px">
      <div class="cs-col reveal"><div class="cs-col-label">Technical</div><div class="cs-col-title" data-editable data-key="sy1t">${d('','sy1t','Engine Work')}</div><p data-editable data-key="sy1b">${d('','sy1b','Blueprint scripts, AI behavior trees, custom events, level streaming setups?')}</p></div>
      <div class="cs-col reveal"><div class="cs-col-label">Tooling</div><div class="cs-col-title" data-editable data-key="sy2t">${d('','sy2t','Pipeline & Tools')}</div><p data-editable data-key="sy2b">${d('','sy2b','Documentation, version control, asset naming, folder structure?')}</p></div>
    </div>`);
}
function challenges() {
  return sec('challenges', SECTION_META.challenges, `
    <h2 class="cs-title" data-editable data-key="ch_title">${d('','ch_title','Challenges & What I Learned')}</h2>
    <div class="cs-2col">
      <div class="cs-col reveal"><div class="cs-col-label" style="color:#ff6b6b">‚úï The Challenge</div><div class="cs-col-title" data-editable data-key="ch1t">${d('','ch1t','Biggest Problem')}</div><p data-editable data-key="ch1b">${d('','ch1b','What was the hardest thing you ran into on this project?')}</p></div>
      <div class="cs-col reveal"><div class="cs-col-label" style="color:var(--accent)">‚úì The Solution</div><div class="cs-col-title" data-editable data-key="ch2t">${d('','ch2t','How I Solved It')}</div><p data-editable data-key="ch2b">${d('','ch2b','How did you work through it? What would you do differently?')}</p></div>
    </div>`);
}
function ldd() {
  // LDD section with inline expandable document
  const el = sec('ldd', SECTION_META.ldd, `
    <h2 class="cs-title" data-editable data-key="ldd_title">${d('','ldd_title','Level Design Document')}</h2>
    <div class="cs-body" data-editable data-key="ldd_intro">${d('','ldd_intro','<p>The full LDD covers all design decisions, player flow, encounter specs, and technical requirements for this level.</p>')}</div>
    <div class="ldd-panel" id="ldd-panel">
      <div class="ldd-panel-header">
        <span class="ldd-panel-title" data-editable data-key="ldd_doc_title">${d('','ldd_doc_title','LDD ‚Äî ' + (project?.title||'Project'))}</span>
        <button class="ldd-panel-close" onclick="toggleLDD()">Close √ó</button>
      </div>
      <div class="ldd-panel-body">
        <div class="ldd-section">
          <div class="ldd-section-title" data-editable data-key="ldd_s1_title">${d('','ldd_s1_title','1. Overview & Concept')}</div>
          <div class="ldd-text" data-editable data-key="ldd_s1_body">${d('','ldd_s1_body','Describe the level concept, theme, and narrative context. What is the player doing here? What is the setting?')}</div>
        </div>
        <div class="ldd-section">
          <div class="ldd-section-title" data-editable data-key="ldd_s2_title">${d('','ldd_s2_title','2. Player Goals & Win Conditions')}</div>
          <div class="ldd-text" data-editable data-key="ldd_s2_body">${d('','ldd_s2_body','What does the player need to accomplish? What are the primary and secondary objectives?')}</div>
          <div class="ldd-grid">
            <div class="ldd-item"><div class="ldd-item-label">Primary Goal</div><div class="ldd-item-val" data-editable data-key="ldd_goal1">${d('','ldd_goal1','Reach the extraction point')}</div></div>
            <div class="ldd-item"><div class="ldd-item-label">Secondary Goal</div><div class="ldd-item-val" data-editable data-key="ldd_goal2">${d('','ldd_goal2','Collect intel documents')}</div></div>
            <div class="ldd-item"><div class="ldd-item-label">Optional Goal</div><div class="ldd-item-val" data-editable data-key="ldd_goal3">${d('','ldd_goal3','No-alert stealth bonus')}</div></div>
            <div class="ldd-item"><div class="ldd-item-label">Fail Condition</div><div class="ldd-item-val" data-editable data-key="ldd_goal4">${d('','ldd_goal4','Player death')}</div></div>
          </div>
        </div>
        <div class="ldd-section">
          <div class="ldd-section-title" data-editable data-key="ldd_s3_title">${d('','ldd_s3_title','3. Level Flow & Pacing')}</div>
          <div class="ldd-text" data-editable data-key="ldd_s3_body">${d('','ldd_s3_body','Describe the pacing beats: introduction zone ‚Üí exploration ‚Üí first encounter ‚Üí escalation ‚Üí climax ‚Üí resolution. Include estimated time per zone.')}</div>
        </div>
        <div class="ldd-section">
          <div class="ldd-section-title" data-editable data-key="ldd_s4_title">${d('','ldd_s4_title','4. Encounter Specifications')}</div>
          <div class="ldd-text" data-editable data-key="ldd_s4_body">${d('','ldd_s4_body','Detail each combat or challenge encounter: enemy count, placement, patrol patterns, cover positions, player approach options.')}</div>
        </div>
        <div class="ldd-section">
          <div class="ldd-section-title" data-editable data-key="ldd_s5_title">${d('','ldd_s5_title','5. Environmental Storytelling')}</div>
          <div class="ldd-text" data-editable data-key="ldd_s5_body">${d('','ldd_s5_body','What story does the environment tell without dialogue? Props, lighting, destruction, notes, staging choices that communicate narrative.')}</div>
        </div>
        <div class="ldd-section">
          <div class="ldd-section-title" data-editable data-key="ldd_s6_title">${d('','ldd_s6_title','6. Technical Requirements')}</div>
          <div class="ldd-text" data-editable data-key="ldd_s6_body">${d('','ldd_s6_body','Engine-specific requirements, trigger volumes, streaming zones, performance constraints, asset lists.')}</div>
          <div class="ldd-grid">
            <div class="ldd-item"><div class="ldd-item-label">Engine</div><div class="ldd-item-val" data-editable data-key="ldd_tech1">${d('','ldd_tech1','Unreal Engine 5')}</div></div>
            <div class="ldd-item"><div class="ldd-item-label">Target Platform</div><div class="ldd-item-val" data-editable data-key="ldd_tech2">${d('','ldd_tech2','PC')}</div></div>
            <div class="ldd-item"><div class="ldd-item-label">Estimated Play Time</div><div class="ldd-item-val" data-editable data-key="ldd_tech3">${d('','ldd_tech3','15‚Äì20 min')}</div></div>
            <div class="ldd-item"><div class="ldd-item-label">Level Scale</div><div class="ldd-item-val" data-editable data-key="ldd_tech4">${d('','ldd_tech4','Medium ‚Äî indoor/outdoor hybrid')}</div></div>
          </div>
        </div>
      </div>
    </div>`);
  return el;
}
function gallery() {
  const imgs = csData['gallery'] ? JSON.parse(csData['gallery']) : Array(6).fill(null);
  galleryImgs = imgs;
  const el = sec('gallery', SECTION_META.gallery, `
    <h2 class="cs-title" data-editable data-key="ga_title">${d('','ga_title','Screenshots & Process')}</h2>
    <div class="cs-gallery" id="csGallery"></div>`);
  // Gallery rendered after insertion
  setTimeout(() => renderGallery(), 0);
  return el;
}

// Generic section wrapper
function sec(id, meta, innerHTML) {
  const el = document.createElement('section');
  el.className = 'cs-section reveal';
  el.id = 'section-' + id;
  el.dataset.sectionId = id;
  el.innerHTML = `
    <div class="section-drag-handle" title="Drag to reorder"><span></span><span></span><span></span></div>
    <div class="cs-label">${meta.num} ‚Äî ${meta.label}</div>
    ${innerHTML}`;
  return el;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SIDEBAR NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildSidebar() {
  const order = csData['section_order'] ? JSON.parse(csData['section_order']) : DEFAULT_SECTION_ORDER;
  let navHtml = '';
  order.forEach((id, i) => {
    const m = SECTION_META[id];
    if (!m) return;
    navHtml += `<li class="snav-item"><a href="#section-${id}" data-section="${id}"><span class="snav-num">${String(i+1).padStart(2,'0')}</span> ${m.sidebar}</a></li>`;
  });
  document.getElementById('sidebarNav').innerHTML = navHtml;

  document.getElementById('sprojLinks').innerHTML =
    allProjects.map((p,i) => `
      <a href="project.html?id=${i}" class="sproj-link ${i===projectId?'cur':''}">
        <span class="sproj-dot"></span>${p.title}
      </a>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FOOTER NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildFooterNav() {
  const prev = allProjects[projectId-1], next = allProjects[projectId+1];
  document.getElementById('projNav').innerHTML = `
    ${prev ? `<a href="project.html?id=${projectId-1}" class="pn-item"><span class="pn-dir">‚Üê Previous</span><div class="pn-title">${prev.title}</div></a>`
           : `<div class="pn-item" style="opacity:.22;pointer-events:none"><span class="pn-dir">‚Üê Previous</span><div class="pn-title" style="font-size:14px;font-family:'Space Mono',monospace">First project</div></div>`}
    ${next ? `<a href="project.html?id=${projectId+1}" class="pn-item" style="text-align:right"><span class="pn-dir">Next ‚Üí</span><div class="pn-title">${next.title}</div></a>`
           : `<div class="pn-item" style="opacity:.22;pointer-events:none;text-align:right"><span class="pn-dir">Next ‚Üí</span><div class="pn-title" style="font-size:14px;font-family:'Space Mono',monospace">Last project</div></div>`}`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LDD TOGGLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleLDD() {
  lddOpen = !lddOpen;
  const panel = document.getElementById('ldd-panel');
  if (panel) {
    panel.classList.toggle('open', lddOpen);
    if (lddOpen) setTimeout(()=>scrollToSection('ldd'), 100);
  }
  const btn = document.getElementById('btnLDD');
  if (btn) btn.classList.toggle('active', lddOpen);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TAGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTagsHTML(containerId, tags) {
  return tags.map((t,i) => `
    <span class="cs-tag ${csData[`ta_${containerId}_${i}`]?'on':''}">
      ${t}
      <span class="tdel" onclick="event.stopPropagation();deleteTag('${containerId}',${i})">√ó</span>
    </span>`).join('');
}

function initTagClicks(containerId) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.querySelectorAll('.cs-tag').forEach((tag,i) => {
    tag.addEventListener('click', () => {
      tag.classList.toggle('on');
      csData[`ta_${containerId}_${i}`] = tag.classList.contains('on');
      persist();
    });
  });
}

function getTagList(cid) {
  const el = document.getElementById(cid);
  if (!el) return [];
  return Array.from(el.querySelectorAll('.cs-tag')).map(t=>t.childNodes[0].textContent.trim());
}

function deleteTag(cid, idx) {
  const tags = getTagList(cid);
  tags.splice(idx,1);
  const el = document.getElementById(cid);
  if (el) { el.innerHTML = renderTagsHTML(cid, tags); initTagClicks(cid); }
  persistTags(cid, tags);
}

function persistTags(cid, tags) {
  if (cid==='expTags') csData['exp_tags'] = JSON.stringify(tags);
  persist();
}

let activeTagsCid = null;
function openTagModal(cid) {
  activeTagsCid = cid;
  document.getElementById('tagInput').value = '';
  document.getElementById('tagModal').classList.add('open');
  setTimeout(()=>document.getElementById('tagInput').focus(), 60);
}
function closeTagModal() { document.getElementById('tagModal').classList.remove('open'); activeTagsCid=null; }
function submitTags() {
  const raw = document.getElementById('tagInput').value.trim();
  if (!raw || !activeTagsCid) return;
  const tags = getTagList(activeTagsCid);
  raw.split(',').map(t=>t.trim()).filter(Boolean).forEach(t=>{ if(!tags.includes(t)) tags.push(t); });
  const el = document.getElementById(activeTagsCid);
  if (el) { el.innerHTML = renderTagsHTML(activeTagsCid, tags); initTagClicks(activeTagsCid); }
  persistTags(activeTagsCid, tags);
  document.getElementById('tagInput').value = '';
  showToast('Tag added','success');
}
document.getElementById('tagInput').addEventListener('keydown', e => {
  if (e.key==='Enter') submitTags();
  if (e.key==='Escape') closeTagModal();
});
document.getElementById('tagModal').addEventListener('click', e => {
  if (e.target===document.getElementById('tagModal')) closeTagModal();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GALLERY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderGallery() {
  const el = document.getElementById('csGallery');
  if (!el) return;
  galleryImgs = csData['gallery'] ? JSON.parse(csData['gallery']) : Array(6).fill(null);
  el.innerHTML = '';
  galleryImgs.forEach((img, i) => {
    const slot = document.createElement('div');
    if (img) {
      slot.className = 'gslot filled';
      slot.innerHTML = `
        <img src="${img.src||img}" alt="Screenshot ${i+1}" onerror="this.closest('.gslot').className='gslot empty';this.remove()">
        <div class="gexpand"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:28px;height:28px"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg></div>
        <button class="gdel" onclick="event.stopPropagation();removeImg(${i})" title="Remove">√ó</button>`;
      slot.addEventListener('click', ()=>openLightbox(i));
    } else {
      slot.className = 'gslot empty';
      slot.innerHTML = `
        <svg class="gempty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:26px;height:26px"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
        <span class="gempty-label">Upload Image</span>
        <input type="file" accept="image/*" data-slot="${i}">`;
      slot.querySelector('input').addEventListener('change', function() {
        const file=this.files[0]; if(!file) return;
        const r=new FileReader();
        r.onload=ev=>{ galleryImgs[i]={src:ev.target.result,file:file.name}; saveGallery(); renderGallery(); showToast(`Image added ‚Äî also upload ${file.name}`, 'success'); };
        r.readAsDataURL(file);
      });
    }
    el.appendChild(slot);
  });
}

function removeImg(idx) {
  if (!confirm('Remove image?')) return;
  galleryImgs[idx]=null; saveGallery(); renderGallery();
}
function addGallerySlot() {
  galleryImgs.push(null); saveGallery(); renderGallery();
  showToast('Slot added','success');
}
function saveGallery() { csData['gallery']=JSON.stringify(galleryImgs); persist(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LIGHTBOX
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openLightbox(startIdx) {
  const filled = galleryImgs.map((g,i)=>g?i:-1).filter(i=>i>=0);
  if (!filled.length) return;
  lbIndex = Math.max(0, filled.indexOf(startIdx));
  showLb(filled);
  document.getElementById('lb').classList.add('open');
  document.body.style.overflow='hidden';
}
function showLb(filled) {
  filled = filled || galleryImgs.map((g,i)=>g?i:-1).filter(i=>i>=0);
  const g = galleryImgs[filled[lbIndex]];
  document.getElementById('lbImg').src = g?.src||g;
  document.getElementById('lbCount').textContent = `${lbIndex+1} / ${filled.length}`;
}
function lbClose() { document.getElementById('lb').classList.remove('open'); document.body.style.overflow=''; }
function lbStep(dir) {
  const filled = galleryImgs.map((g,i)=>g?i:-1).filter(i=>i>=0);
  lbIndex = (lbIndex+dir+filled.length)%filled.length;
  showLb(filled);
}
document.addEventListener('keydown', e => {
  if (e.key==='Escape') { lbClose(); closeTagModal(); }
  if (e.key==='ArrowLeft'  && document.getElementById('lb').classList.contains('open')) lbStep(-1);
  if (e.key==='ArrowRight' && document.getElementById('lb').classList.contains('open')) lbStep(1);
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HERO IMAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('heroImgInput').addEventListener('change', function() {
  const file=this.files[0]; if(!file) return;
  const r=new FileReader();
  r.onload=e=>{ const img=document.getElementById('heroImg'); img.src=e.target.result; img.style.display='block';
    if(project){project._imageDataUrl=e.target.result;project._imageFile=file.name;}
    localStorage.setItem('rg_projects',JSON.stringify(allProjects));
    showToast(`Hero image set ‚Äî also upload ${file.name}`,'success'); };
  r.readAsDataURL(file);
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DRAG & DROP SECTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let dragSec = null;

function enableSectionDrag() {
  document.querySelectorAll('.cs-section').forEach(sec => {
    sec.draggable = true;
    sec.addEventListener('dragstart', onSecDragStart);
    sec.addEventListener('dragover',  onSecDragOver);
    sec.addEventListener('drop',      onSecDrop);
    sec.addEventListener('dragend',   onSecDragEnd);
  });
}
function disableSectionDrag() {
  document.querySelectorAll('.cs-section').forEach(sec => {
    sec.draggable = false;
    sec.removeEventListener('dragstart', onSecDragStart);
    sec.removeEventListener('dragover',  onSecDragOver);
    sec.removeEventListener('drop',      onSecDrop);
    sec.removeEventListener('dragend',   onSecDragEnd);
  });
}
function onSecDragStart(e) { dragSec=this; this.classList.add('dragging-section'); e.dataTransfer.effectAllowed='move'; }
function onSecDragOver(e) { e.preventDefault(); document.querySelectorAll('.cs-section').forEach(s=>s.classList.remove('drag-over-section')); this.classList.add('drag-over-section'); }
function onSecDragEnd() { document.querySelectorAll('.cs-section').forEach(s=>{s.classList.remove('dragging-section');s.classList.remove('drag-over-section');}); dragSec=null; }
function onSecDrop(e) {
  e.preventDefault();
  if (!dragSec || dragSec===this) return;
  const container = document.getElementById('mainContent');
  const sections = [...container.querySelectorAll('.cs-section')];
  const fromIdx = sections.indexOf(dragSec);
  const toIdx   = sections.indexOf(this);
  if (fromIdx < toIdx) this.after(dragSec);
  else this.before(dragSec);
  // Save new order
  const newOrder = [...container.querySelectorAll('.cs-section')].map(s=>s.dataset.sectionId);
  csData['section_order'] = JSON.stringify(newOrder);
  persist();
  buildSidebar();
  showToast('Section order saved','success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EDIT MODES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleMode(mode) {
  if (mode==='text') {
    textOn=!textOn;
    document.getElementById('btn-text').classList.toggle('on',textOn);
    document.querySelectorAll('[data-editable]').forEach(el=>{
      el.contentEditable = textOn ? 'true' : 'false';
      if (textOn) el.addEventListener('blur', onEditBlur);
      else el.removeEventListener('blur', onEditBlur);
    });
    showToast(textOn?'Click any text to edit it ‚Äî including titles, bodies, stats':'Text editing off','success');
  }
  if (mode==='images') {
    document.getElementById('btn-images').classList.toggle('on');
    showToast('Use "Change Hero Image" below the hero. Gallery: click empty slots to upload.','success');
  }
  if (mode==='tags') {
    document.getElementById('btn-tags').classList.toggle('on');
    showToast('√ó to delete tag ¬∑ + Add Tag to add new ones','success');
  }
  if (mode==='drag') {
    dragOn=!dragOn;
    document.getElementById('btn-drag').classList.toggle('on',dragOn);
    if (dragOn) { enableSectionDrag(); showToast('Drag the ‚â° handle on each section to reorder','success'); }
    else { disableSectionDrag(); showToast('Reorder mode off','success'); }
  }
}

function onEditBlur(e) {
  const k=e.target.dataset.key;
  if (k) { csData[k]=e.target.innerHTML; persist(); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAVE / PERSIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function persist() { localStorage.setItem(`rg_cs_${projectId}`, JSON.stringify(csData)); }

function saveAll() {
  // Collect all editable
  document.querySelectorAll('[data-editable]').forEach(el=>{
    const k=el.dataset.key; if(k) csData[k]=el.innerHTML.trim();
  });
  // Tags
  csData['exp_tags'] = JSON.stringify(getTagList('expTags'));
  // Gallery
  csData['gallery'] = JSON.stringify(galleryImgs);
  // Section order
  const order = [...document.querySelectorAll('.cs-section')].map(s=>s.dataset.sectionId);
  csData['section_order'] = JSON.stringify(order);
  persist();
  const blob = new Blob([JSON.stringify({projectId,...csData},null,2)],{type:'application/json'});
  const a = document.createElement('a');
  a.href=URL.createObjectURL(blob); a.download=`project-${projectId}-content.json`; a.click();
  showToast(`project-${projectId}-content.json downloaded!`,'success');
}

function logout() { sessionStorage.removeItem('rg_admin'); location.reload(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAV & SIDEBAR SPY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initNav() {
  window.addEventListener('scroll',()=>document.getElementById('topnav').classList.toggle('scrolled',window.scrollY>60),{passive:true});
}
function initSidebarSpy() {
  const updateSpy = () => {
    const sections = document.querySelectorAll('.cs-section');
    const links = document.querySelectorAll('.snav-item a');
    let current = null;
    sections.forEach(s => {
      if (s.getBoundingClientRect().top <= window.innerHeight*.4) current = s.dataset.sectionId;
    });
    links.forEach(l => l.classList.toggle('active', l.dataset.section===current));
  };
  window.addEventListener('scroll', updateSpy, {passive:true});
  updateSpy();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REVEAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initReveal() {
  const obs = new IntersectionObserver(entries=>{
    entries.forEach((e,i)=>{ if(e.isIntersecting){setTimeout(()=>e.target.classList.add('visible'),i*55);obs.unobserve(e.target);} });
  },{threshold:.06});
  document.querySelectorAll('.reveal').forEach(el=>obs.observe(el));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showToast(msg,type='success'){
  const t=document.getElementById('toast');
  t.textContent=msg; t.className=`toast ${type} show`;
  setTimeout(()=>t.classList.remove('show'),4000);
}

// init tag clicks after sections render
document.addEventListener('DOMContentLoaded', ()=>setTimeout(()=>initTagClicks('expTags'),200));
</script>
</body>
</html>
